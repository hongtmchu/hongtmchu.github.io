<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hong T.M. Chu</title>
    
    <!-- Tailwind CSS for styling --><script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Montserrat --><link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" xintegrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        /* Define custom fonts and colors */
        :root {
            --primary-blue: #0033CC; /* Darker blue from image */
            --primary-purple: #6600CC; /* Purple from image */
            /* Updated font stack to Montserrat */
            --body-font: 'Montserrat', sans-serif;
        }

        body {
            font-family: var(--body-font);
            color: #333;
            font-size: 16px; /* Reverted to 16px */
            line-height: 1.3; /* Updated line height to match CSS */
        }
        
        /* Main Header Title (H1) - Style block removed. Will use .section-title class directly. */

        /* Section Title Styling - Applied to all <h2> and <h1> */
        .section-title {
            color: var(--primary-purple); /* Apply purple to section titles */
            font-size: 1.5rem; /* Reverted to 1.5rem (24px) */
            font-weight: 700; /* (Tailwind font-bold) */
            margin-bottom: 1.5rem; /* 24px (Tailwind mb-6) */
            line-height: 1;
        }

        /* New class for the main header's background */
        .main-header {
            /* Using the blue variable with 25% opacity */
            background-color: rgba(0, 51, 204, 0.25); 
            padding: 1rem; /* 16px padding */
            border-radius: 0.375rem; /* 6px rounded corners */
            
            /* Keep the font styles matching section-title */
            color: var(--primary-blue); /* Blue text for contrast */
            font-size: 1.5rem; /* Reverted to 1.5rem */
            font-weight: 700;
            line-height: 1.25;
        }

        /* Sidebar navigation link */
        .sidebar-link {
            display: block;
            font-size: 0.875rem; /* 14px (Tailwind text-md) */
            font-weight: 500; /* (Tailwind font-medium) */
            color: var(--primary-blue);
            margin-bottom: 0.5rem; /* 8px (Tailwind mb-2) */
        }
        .sidebar-link:hover {
            text-decoration: underline;
        }

        /* Publication List Styling */
        .pub-list li {
            margin-bottom: 1rem; /* 16px (Tailwind mb-4) */
            text-align: justify;
        }
        .pub-list a {
            color: var(--primary-blue); /* Use new primary blue for links */
        }
        .pub-list a:hover {
            text-decoration: underline;
        }
        
        /* Simple link styling for About section */
        .bio-link {
            color: var(--primary-blue); /* Use new primary blue for links */
            font-weight: 500; /* (Tailwind font-medium) */
        }
        .bio-link:hover {
            text-decoration: underline;
        }
        
        /* Simple list for News/Research/Services */
        .styled-list li {
            margin-bottom: 0.75rem; /* 12px (Tailwind mb-3) */
        }
        
        /* Use Tailwind for square bullets */
        .list-square {
            list-style-type: square;
        }
        
        .styled-list strong {
            color: #111;
        }
        
        /* Icon styles */
        .icon-link {
             font-size: 0.8em; /* Make icon slightly smaller */
             margin-left: 4px;
             color: var(--primary-blue);
        }
        
        /* Removed .orcid-link class */

        /* New styles for social icon links */
        .social-icon-row {
            margin-top: 0.75rem; /* 12px */
            display: flex;
            align-items: center;
        }
        
        .social-icon {
            font-size: 1.5rem; /* 24px */
            margin-right: 1.25rem; /* 20px spacing */
            color: var(--primary-blue);
            text-decoration: none;
            transition: color 0.2s ease;
        }
        .social-icon:hover {
            color: var(--primary-purple); /* Change to purple on hover */
        }
        
        .social-icon.orcid {
            color: #a6ce39; /* Official ORCID green */
        }
        .social-icon.orcid:hover {
            color: #8ab32f; /* Darker green on hover */
        }

        /* Custom styles for Firebase UI */
        .form-input {
            @apply w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-var(--primary-purple);
        }
        
        .btn-primary {
            @apply px-4 py-2 bg-var(--primary-blue) text-white font-medium rounded-md shadow-sm hover:bg-blue-700 transition-colors duration-200;
        }

        .btn-secondary {
            @apply px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-md shadow-sm hover:bg-gray-300 transition-colors duration-200;
        }

        .btn-danger {
            @apply px-3 py-1 bg-red-600 text-white text-xs font-medium rounded-md shadow-sm hover:bg-red-700 transition-colors duration-200;
        }
        
        .btn-edit {
             @apply px-3 py-1 bg-yellow-500 text-white text-xs font-medium rounded-md shadow-sm hover:bg-yellow-600 transition-colors duration-200;
        }

        /* Modal Styles */
        .modal-backdrop {
            @apply fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50;
        }
        .modal-content {
            @apply bg-white p-6 rounded-lg shadow-xl w-full max-w-lg;
        }

    </style>
</head>
<body class="bg-white text-gray-700">

    <!-- Firebase Services -->
    <!-- Removed the redundant script module that was here -->


    <div class="p-4 sm:p-6 lg:p-8">
        
        <!-- Main Header Title --><h1 class="section-title main-header">
            Hong T.M. Chu (Assistant Professor at VinUniversity)
        </h1>

        <div class="md:flex">
            
            <!-- Left Sidebar Navigation --><aside class="w-full md:w-72 md:flex-shrink-0 md:pr-8 mb-8 md:mb-0">
                <nav class="flex flex-col">
                    <a href="#home" class="sidebar-link">Home</a>
                    <a href="#olab" class="sidebar-link">OLab</a> <!-- New Link -->
                    <a href="#publications" class="sidebar-link">Publications</a>
                    <a href="#awards" class="sidebar-link">Awards</a>
                    <a href="#talks" class="sidebar-link">Talks</a>
                    <a href="#service" class="sidebar-link">Service</a>
                    <a href="#teaching" class="sidebar-link">Teaching</a>
                    <a href="#programming" class="sidebar-link">Programming</a>
                </nav>
            </aside>

            <!-- Main Content Area --><main class="w-full md:w-auto">

                <!-- Home Section --><section id="home" class="mb-12">
                    <h2 class="section-title">Home</h2>
                    
                    <!-- Bio/Profile Section --><div class="flex flex-col md:flex-row items-start mb-8">
                        <div class="md:flex-shrink-0 mb-6 md:mb-0 md:pr-6">
                            <!-- Your photo --><img src="profile.jpg" alt="Hong T.M. Chu" class="rounded-lg shadow-md border border-gray-300 w-40" onerror="this.src='https://placehold.co/150x150/EBF4FF/333333?text=Photo+Not+Found';">
                        </div>
                        <div class="space-y-2">
                            <h3 class="text-2xl font-bold text-gray-900">
                                Hong T.M. Chu, Dr.
                                <!-- ORCID icon removed from here --></h3>
                            <p class="text-md text-gray-600">
                                <strong>✉ Email:</strong> 
                                <a href="mailto:hongtmchu@gmail.com" class="bio-link">hongtmchu@gmail.com</a> / 
                                <a href="mailto:hongtmchu@u.nus.edu" class="bio-link">hongtmchu@u.nus.edu</a>
                            </p>

                            <!-- New Icon Row --><div class="social-icon-row">
                                <a href="https://orcid.org/0009-0002-5674-4685" target="_blank" class="social-icon orcid" title="ORCID iD">
                                    <i class="fa-brands fa-orcid"></i>
                                </a>
                                <a href="https://www.linkedin.com/in/hongtmchu" target="_blank" class="social-icon" title="LinkedIn">
                                    <i class="fa-brands fa-linkedin"></i>
                                </a>
                                <a href="https://scholar.google.com/citations?hl=en&user=ZLXxF3YAAAAJ&view_op=list_works&sortby=pubdate" target="_blank" class="social-icon" title="Google Scholar">
                                    <i class="fa-brands fa-google-scholar"></i>
                                </a>
                            </div>
                            
                            <!-- Text links for LinkedIn and Google Scholar removed --><div class="text-md text-gray-600">
                                [ <a href="CV_HongChu.pdf" class="bio-link" target="_blank">CV</a> ] (Last updated: November 2025)
                            </div>
                        </div>
                    </div>

                    <!-- Research Interests --><div id="research-interests" class="mb-10">
                        <h2 class="section-title">Research Interests</h2>
                        <p class="text-justify">
                            Computational approaches to optimal transport and Wasserstein distributionally robust optimization problems. I specialize in designing fast computational methods and efficient algorithms to solve these problems, particularly in the context of robust machine learning and deep neural networks. A key part of my research involves analyzing tractable regularization techniques and their distributionally robust interpretations.
                        </p>
                    </div>

                    <!-- Short Bio --><div id="short-bio" class="mb-10">
                        <h2 class="section-title">Short Bio</h2>
                        <p class="text-justify">
                            Hong T.M. Chu is currently an Assistant Professor of Mathematics at the College of Engineering and Computer Science, VinUniversity, Vietnam. Prior to her current appointment at VinUniversity, she was a Research Fellow in the Department of Mathematics at the National University of Singapore. She received her PhD in Mathematics from the National University of Singapore under the supervision of Professor Kim-Chuan Toh. She has received Teaching Assistant Awards from the Faculty of Science (AY 2019-2020 & AY 2020-2021) and has been nominated as a Faculty of Science Postgraduate Alumni Ambassador at the National University of Singapore.
                        </p>
                    </div>

                </section>

                <!-- Employment --><section id="employment" class="mb-12">
                    <h2 class="section-title">Employment</h2>
                    <ul class="styled-list list-square list-inside">
                        <li>
                            <strong>[2024 - now] Assistant Professor</strong><br>
                            College of Engineering & Computer Science, VinUniversity, Vietnam
                        </li>
                        <li>
                            <strong>[2023 - 2024] Research Fellow</strong><br>
                            Department of Mathematics, National University of Singapore, Singapore
                        </li>
                        <li>
                            <strong>[2017 - 2018] Research Assistant</strong><br>
                            Institute of Mathematics, Vietnam Academy of Science and Technology, Vietnam
                        </li>
                    </ul>
                </section>

                <!-- Education --><section id="education" class="mb-12">
                    <h2 class="section-title">Education</h2>
                    <ul class="styled-list list-square list-inside">
                        <li>
                            <strong>[2018 - 2023] Ph.D</strong><br>
                            Department of Mathematics, National University of Singapore, Singapore<br>
                            (Supervisor: Professor Kim-Chuan Toh)
                        </li>
                        <li>
                            <strong>[2013 - 2017] Bachelor of Mathematics</strong><br>
                            Faculty of Mathematics & Information Technology, Hanoi National University of Education, Vietnam
                        </li>
                    </ul>
                </section>

                <!-- OLab Section (New) -->
                <section id="olab" class="mb-12 hidden">
                    <h2 class="section-title">OLab (Optimization Lab)</h2>
                    
                    <!-- Auth Section -->
                    <div class="mb-6 p-4 bg-gray-50 rounded-lg border">
                        <div class="flex justify-between items-center">
                            <span id="auth-status" class="text-sm font-medium text-gray-600">Initializing...</span>
                            <div>
                                <button id="member-login-btn" class="btn-primary">Lab Member Login (Google)</button>
                                <button id="member-logout-btn" class="btn-secondary hidden">Logout</button>
                            </div>
                        </div>
                    </div>

                    <!-- Add New Member Form (Hidden by default) -->
                    <form id="add-member-form" class="mb-10 p-6 bg-blue-50 border border-blue-200 rounded-lg space-y-4 hidden">
                        <h3 class="text-xl font-semibold text-var(--primary-blue)">Add New Member (Stub Profile)</h3>
                        <p class="text-sm text-gray-600">You only need to add the member's name and Google-based email. They can log in and fill out the rest of their profile themselves.</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                                <input type="text" id="name" name="name" class="form-input" required>
                            </div>
                            <div>
                                <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email (Must match Google account)</label>
                                <input type="email" id="email" name="email" class="form-input" required>
                            </div>
                        </div>
                        <!-- Removed all other fields for the admin form -->
                        <button type="submit" class="btn-primary">Add Member</button>
                    </form>

                    <!-- Member Lists -->
                    <div class="mb-8">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">Members</h3>
                        <div id="members-list" class="space-y-4">
                            <!-- JS will populate this -->
                            <p class="text-gray-500">Loading members...</p>
                        </div>
                    </div>

                    <!-- REMOVED Alumni Section -->
                </section>


                <!-- Publications & Preprints --><section id="publications" class="mb-12 hidden">
                    <h2 class="section-title">Publications</h2>
                    <ul class="pub-list list-none"> <!-- Publication list does not use bullets --><li>
                            <a href="https://www.google.com/search?q=Tight+Robustness+Certificates+and+Wasserstein+Distributional+Attacks+for+Deep+Neural+Networks" target="_blank">Tight Robustness Certificates and Wasserstein Distributional Attacks for Deep Neural Networks</a><br>
                            Bach C. Le, Tung V. Dao, Binh T. Nguyen, <strong>Hong T.M. Chu</strong>. <em>Submitted.</em>
                        </li>
                        <li>
                            <a href="https://www.google.com/search?q=Implicit+Regularization+via+Spectral+Neural+Networks+and+Non-linear+Matrix+Sensing" target="_blank">Implicit Regularization via Spectral Neural Networks and Non-linear Matrix Sensing</a><br>
                            <strong>Hong T. M. Chu</strong>, Subhro Ghosh, Chi Thanh Lam, Soumendu Sundar Mukherjee.
                        </li>
                        <li>
                            <a href="https://www.google.com/search?q=Wasserstein+distributionally+robust+optimization+and+its+tractable+regularization+formulations" target="_blank">Wasserstein distributionally robust optimization and its tractable regularization formulations</a><br>
                            <strong>Hong T.M. Chu</strong>, Meixia Lin, Kim-Chuan Toh. <em>Submitted.</em>
                        </li>
                        <li>
                            <a href="https://www.google.com/search?q=A+Corrected+Inexact+Proximal+Augmented+Lagrangian+Method+with+a+Relative+Error+Criterion+for+a+Class+of+Group-quadratic+Regularized+Optimal+Transport+Problems" target="_blank">A Corrected Inexact Proximal Augmented Lagrangian Method with a Relative Error Criterion for a Class of Group-quadratic Regularized Optimal Transport Problems</a><br>
                            Lei Yang, Ling Liang, <strong>Hong T.M. Chu</strong>, Kim-Chuan Toh. <em>Journal of Scientific Computing 99 (3), 79.</em>
                        </li>
                        <li>
                            <a href="https://www.google.com/search?q=On+Regularized+Square-root+Regression+Problems:+Distributionally+Robust+Interpretation+and+Fast+Computations" target="_blank">On Regularized Square-root Regression Problems: Distributionally Robust Interpretation and Fast Computations</a><br>
                            <strong>Hong T.M. Chu</strong>, Kim-Chuan Toh, Yangjing Zhang. <em>Journal of Machine Learning Research, 23(308):1–39.</em>
                        </li>
                        <li>
                            <a href="https://www.google.com/search?q=An+efficient+implementable+inexact+entropic+proximal+point+algorithm+for+a+class+of+linear+programming+problems" target="_blank">An efficient implementable inexact entropic proximal point algorithm for a class of linear programming problems</a><br>
                            <strong>Hong T. M. Chu</strong>, Ling Liang, Kim-Chuan Toh, Lei Yang. <em>Computational Optimization and Applications, (2023): 1-40.</em>
                        </li>
                    </ul>
                </section>

                <!-- Selected Awards --><section id="awards" class="mb-12 hidden">
                    <h2 class="section-title">Awards</h2>
                    <ul class="styled-list list-square list-inside">
                        <li>
                            <strong>[2021] Teaching award</strong>
                            <a href="https://www.science.nus.edu.sg/blog/2022/01/07/faculty-award-2021-winners/" target="_blank" class="icon-link">
                                <i class="fa-solid fa-arrow-up-right-from-square"></i>
                            </a>
                            <br>
                            Part-time teaching assistant award AY 2020/2021<br>
                            Faculty of Science, National University of Singapore, Singapore
                        </li>
                        <li>
                            <strong>[2020] Teaching award</strong>
                            <a href="https://www.math.nus.edu.sg/about/faculty-awards-accolades-for-staff/" target="_blank" class="icon-link">
                                <i class="fa-solid fa-arrow-up-right-from-square"></i>
                            </a>
                            <br>
                            Part-time teaching assistant award AY 19/2020<br>
                            Faculty of Science, National University of Singapore, Singapore
                        </li>
                    </ul>
                </section>

                <!-- Talks & Presentations --><section id="talks" class="mb-12 hidden">
                    <h2 class="section-title">Talks</h2>
                    <ul class="styled-list list-square list-inside">
                        <li>
                            <strong>[October 2025]</strong> International Workshop on Weakly Supervised Learning, Southeast University, Nanjing, China
                        </li>
                        <li>
                            <strong>[June 2023]</strong> SAMI, Hanoi University of Science and Technology, Hanoi, Vietnam
                        </li>
                        <li>
                            <strong>[May 2023]</strong> SIAM Conference on Optimization, Seattle, USA
                        </li>
                         <li>
                            <strong>[March 2023]</strong> The 6th Mathematics Symposium in Singapore, Singapore
                        </li>
                    </ul>
                </section>

                <!-- Administrative Experience --><section id="service" class="mb-12 hidden">
                    <h2 class="section-title">Service</h2>
                    <ul class="styled-list list-square list-inside">
                        <li>
                            <strong>[2023 - 2028] Ambassador</strong><br>
                            Appointment as Faculty of Science Postgraduate Alumni Ambassador (FPAA), National University of Singapore, Singapore
                        </li>
                        <li>
                            <strong>[Spring 2024] Preliminary & Final Judge</strong><br>
                            Singapore Science & Engineering Fair (SSEF), MOE, A*STAR and SCS, Singapore
                        </li>
                        <li>
                            <strong>[Jan 2024] Member</strong>
                            <a href="https://ims.nus.edu.sg/events/the-mathematics-of-data/" target="_blank" class="icon-link">
                                <i class="fa-solid fa-arrow-up-right-from-square"></i>
                            </a>
                            <br>
                            The Mathematics of Data, Institute for Mathematical Sciences, Singapore
                        </li>
                    </ul>
                </section>
                
                <!-- Pedagogical Experience --><section id="teaching" class="mb-12 hidden">
                    <h2 class="section-title">Teaching</h2>
                    <ul class="styled-list list-square list-inside">
                        <li>
                            <strong>[Fall 2024] Lecturer, MATH2010</strong><br>
                            Probability & Statistics (VinUniversity)<br>
                            Average student rating: 4.68/5.0
                        </li>
                        <li>
                            <strong>[Spring 2022, Fall 2021, Fall 2020] Teaching assistant, DSA3102</strong><br>
                            Essential Data Analytics Tools: Convex Optimisation (National University of Singapore)<br>
                            Average student rating: 4.1/5.0
                        </li>
                         <li>
                            <strong>[Spring 2020] Teaching assistant, MA3252</strong><br>
                            Linear and Network Optimisation (National University of Singapore)<br>
                            Average student rating: 4.4/5.0
                        </li>
                         <li>
                            <strong>[Fall 2019] Teaching assistant, MA1102R</strong><br>
                            Calculus (National University of Singapore)<br>
                            Average student rating: 4.4/5.0
                        </li>
                    </ul>
                </section>
                
                <!-- Programming Languages --><section id="programming" class="mb-12 hidden">
                    <h2 class="section-title">Programming</h2>
                    <ul class="styled-list list-square list-inside">
                        <li>MATLAB, PYTHON</li>
                    </ul>
                </section>

                <!-- Footer --><footer class="mt-16 border-t border-gray-200 pt-8">
                    <div class="text-center text-sm text-gray-500">
                        <p>&copy; <span id="year"></span> Hong T.M. Chu. Last updated: November 2025</p>
                    </div>
                </footer>

            </main>
        </div>
    </div>

    <!-- Edit Modal (Hidden by default) -->
    <div id="edit-modal" class="modal-backdrop hidden">
        <div class="modal-content overflow-y-auto max-h-[90vh]">
            <h3 class="text-xl font-semibold mb-4">Edit Member Profile</h3>
            
            <form id="edit-member-form" class="space-y-4">
                
                <!-- Name and Email (Read-only) -->
                <div>
                    <label for="edit-name" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                    <input type="text" id="edit-name" name="name" class="form-input" required>
                </div>
                <div>
                    <label for="edit-email" class="block text-sm font-medium text-gray-700 mb-1">Email (Cannot be changed)</label>
                    <input type="email" id="edit-email" name="email" class="form-input bg-gray-100" readonly>
                </div>
                
                <hr>
                
                <!-- Start Date (Compulsory) -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="edit-start-month" class="block text-sm font-medium text-gray-700 mb-1">Start Month <span class="text-red-500">*</span></label>
                        <select id="edit-start-month" name="startMonth" class="form-input" required>
                            <!-- JS will populate months -->
                        </select>
                    </div>
                    <div>
                        <label for="edit-start-year" class="block text-sm font-medium text-gray-700 mb-1">Start Year <span class="text-red-500">*</span></label>
                        <input type="number" id="edit-start-year" name="startYear" class="form-input" placeholder="YYYY" required min="1990" max="2100">
                    </div>
                </div>

                <!-- End Date (Compulsory) -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="edit-end-month" class="block text-sm font-medium text-gray-700 mb-1">End Month <span class="text-red-500">*</span></label>
                        <select id="edit-end-month" name="endMonth" class="form-input" required>
                            <option value="Now">Now</option>
                            <!-- JS will populate months -->
                        </select>
                    </div>
                    <div>
                        <label for="edit-end-year" class="block text-sm font-medium text-gray-700 mb-1">End Year <span class="text-red-500">*</span></label>
                        <input type="text" id="edit-end-year" name="endYear" class="form-input" placeholder="YYYY or Now" required>
                    </div>
                </div>
                
                <!-- Current Institution (Conditionally Compulsory) -->
                <div id="institution-field-container">
                    <label for="edit-current-institution" class="block text-sm font-medium text-gray-700 mb-1">
                        Current Institution 
                        <span id="institution-required-star" class="text-red-500 hidden">*</span>
                        <span class="text-xs text-gray-500">(Compulsory if end date is not 'Now')</span>
                    </label>
                    <input type="text" id="edit-current-institution" name="currentInstitution" class="form-input">
                </div>

                <hr>

                <!-- Optional Fields -->
                <div>
                    <label for="edit-research-topic" class="block text-sm font-medium text-gray-700 mb-1">Research Topic (Optional)</label>
                    <textarea id="edit-research-topic" name="researchTopic" class="form-input" rows="2" placeholder="e.g., Optimal Transport, Robust Optimization..."></textarea>
                </div>
                <div>
                    <label for="edit-publications" class="block text-sm font-medium text-gray-700 mb-1">Preprints/Publications (Optional)</label>
                    <textarea id="edit-publications" name="publications" class="form-input" rows="3" placeholder="Add links or text, one per line..."></textarea>
                </div>
                <div>
                    <label for="edit-homepage" class="block text-sm font-medium text-gray-700 mb-1">Personal Homepage (Optional)</label>
                    <input type="url" id="edit-homepage" name="homepage" class="form-input" placeholder="https://...">
                </div>
                <div>
                    <label for="edit-cv-url" class="block text-sm font-medium text-gray-700 mb-1">Link to CV (Optional)</label>
                    <input type="url" id="edit-cv-url" name="cvUrl" class="form-input" placeholder="https://...">
                </div>

                <!-- Removed edit-status select -->
                
                <div class="flex justify-end space-x-4">
                    <button type="button" id="cancel-edit" class="btn-secondary">Cancel</button>
                    <button type="submit" class="btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>


    <script>
        // --- Basic UI functionality ---
        document.getElementById('year').textContent = new Date().getFullYear();
        
        // --- Tabbed Page Functionality ---
        const links = document.querySelectorAll('.sidebar-link');
        const mainContent = document.querySelector('main');
        
        links.forEach(link => {
            link.addEventListener('click', function(e) { // <-- Fixed: Added missing '('
                e.preventDefault(); // Stop the anchor jump
                
                const targetId = this.getAttribute('href').substring(1); // Get 'home', 'education', etc.

                // Hide all <section> elements inside <main>
                mainContent.querySelectorAll('section').forEach(section => {
                    section.classList.add('hidden');
                });

                // Show the target section(s)
                if (targetId === 'home') {
                    // If "Home" is clicked, show home, employment, and education
                    document.getElementById('home').classList.remove('hidden');
                    document.getElementById('employment').classList.remove('hidden');
                    document.getElementById('education').classList.remove('hidden');
                } else {
                    // Otherwise, just show the specific section clicked
                    const targetSection = document.getElementById(targetId);
                    if (targetSection) {
                        targetSection.classList.remove('hidden');
                    }
                }
                
                // Scroll to the top of the main content area for better visibility
                mainContent.scrollTop = 0; 
                window.scrollTo(0, 0); // Also scroll the main window
            });
        });
        
        // --- Initial Load ---
        // Manually show the 'home', 'employment', and 'education' sections on first load.
        document.addEventListener('DOMContentLoaded', () => {
             document.getElementById('home').classList.remove('hidden');
             document.getElementById('employment').classList.remove('hidden');
             document.getElementById('education').classList.remove('hidden');
             
             // --- Firebase UI Global Element References ---
             // We have to re-declare them here because the script tag is not a module
             // and can't see the consts in the module script.
             // This is a bit redundant but necessary for the tab logic to find the elements.
             
             // Actually, the module script can't access the tab script and vice-versa.
             // We will put ALL script logic into the module script.
        });
    </script>
    
    <!-- We must move the tabbed page functionality into the module script
         to avoid scope issues. -->
    <script type="module">
        // --- Firebase Imports ---
        import { initializeApp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged, 
            GoogleAuthProvider, 
            signInWithPopup, 
            signOut,
            signInAnonymously,
            signInWithCustomToken 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            doc, 
            addDoc, 
            setDoc, 
            deleteDoc, 
            onSnapshot,
            query
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- App/Auth Configuration ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfigStr = typeof __firebase_config !== 'undefined' ? __firebase_config : '{}';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let firebaseConfig = {};
        try {
            firebaseConfig = JSON.parse(firebaseConfigStr);
        } catch (e) {
            console.error("Failed to parse Firebase config:", e);
        }

        let app, auth, db;
        let currentUserId = null;
        let currentUserEmail = null;
        
        const membersCollectionPath = `/artifacts/${appId}/public/data/olab-members`;

        // --- UI Element References ---
        const loginButton = document.getElementById('member-login-btn');
        const logoutButton = document.getElementById('member-logout-btn');
        const authStatus = document.getElementById('auth-status');
        const addMemberForm = document.getElementById('add-member-form');
        const currentMembersList = document.getElementById('current-members-list'); // This is still in the old file
        const alumniMembersList = document.getElementById('alumni-members-list'); // This is still in the old file
        const membersList = document.getElementById('members-list'); // This is the new one
        const editModal = document.getElementById('edit-modal');
        const editMemberForm = document.getElementById('edit-member-form');
        const cancelEditButton = document.getElementById('cancel-edit');
        let currentEditingDocId = null;
        
        // --- Main Function ---
        function main() {
            // --- 1. Initialize Firebase ---
            try {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                // setLogLevel('Debug'); // Uncomment for verbose logs
                console.log("Firebase initialized.");
                setupAuthListener();
                
                // Check for login redirect result
                handleRedirectLogin();
            } catch (e) {
                console.error("Firebase initialization failed:", e);
                if (authStatus) authStatus.textContent = "Error: Could not connect to database.";
            }

            // --- New function to handle redirect result ---
            async function handleRedirectLogin() {
                try {
                    const result = await getRedirectResult(auth);
                    if (result && result.user) {
                        // User has just logged in via redirect.
                        // onAuthStateChanged will handle the UI updates.
                        console.log("Logged in via redirect:", result.user.email);
                    }
                } catch (error) {
                    console.error("Redirect login error:", error);
                }
            }

            // --- 2. Authentication Listener ---
            function setupAuthListener() {
                onAuthStateChanged(auth, async (user) => {
                    if (user && !user.isAnonymous) {
                        // User is signed in with Google
                        currentUserId = user.uid;
                        currentUserEmail = user.email;
                        
                        if (authStatus) {
                            authStatus.textContent = `Logged in as: ${user.displayName || user.email}`;
                            loginButton.classList.add('hidden');
                            logoutButton.classList.remove('hidden');
                        }
                        if (addMemberForm) addMemberForm.classList.remove('hidden');
                        
                        await loadLabMembers();

                    } else if (user && user.isAnonymous) {
                         // User is signed in anonymously
                        currentUserId = user.uid;
                        currentUserEmail = null;
                        
                        if (authStatus) {
                            authStatus.textContent = "You are browsing as a guest.";
                            loginButton.classList.remove('hidden');
                            logoutButton.classList.add('hidden');
                        }
                        if (addMemberForm) addMemberForm.classList.add('hidden');

                        await loadLabMembers();
                        
                    } else {
                        // User is signed out, or no token
                        // Try to sign in with token or fall back to anonymous
                        if (initialAuthToken) {
                            try {
                                const userCredential = await signInWithCustomToken(auth, initialAuthToken);
                                // This is the *professor*
                                currentUserId = userCredential.user.uid;
                                currentUserEmail = userCredential.user.email || 'professor@admin.com'; // Token might not have email
                                
                                if (authStatus) {
                                    authStatus.textContent = `Logged in as: Professor (Admin)`;
                                    loginButton.classList.add('hidden');
                                    logoutButton.classList.remove('hidden');
                                }
                                if (addMemberForm) addMemberForm.classList.remove('hidden');
                                await loadLabMembers();
                                
                            } catch (e) {
                                console.error("Custom token sign-in failed, falling back to anonymous:", e);
                                await signInAnonymously(auth); // onAuthStateChanged will fire again
                            }
                        } else {
                            // No token, sign in anonymously
                            try {
                                await signInAnonymously(auth); // onAuthStateChanged will fire again
                            } catch (e) {
                                console.error("Anonymous sign-in failed:", e);
                            }
                        }
                    }
                });
            }

            // --- 3. Google Login/Logout Handlers ---
            if (loginButton) {
                loginButton.addEventListener('click', async () => {
                    try {
                        const provider = new GoogleAuthProvider();
                        // Changed to use redirect instead of popup
                        await signInWithRedirect(auth, provider);
                    } catch (e) {
                        console.error("Google sign-in error:", e);
                    }
                });
            }
            
            if (logoutButton) {
                logoutButton.addEventListener('click', async () => {
                    try {
                        const wasAdmin = !!initialAuthToken && auth.currentUser?.uid === (await signInWithCustomToken(auth, initialAuthToken).catch(() => ({})))?.user?.uid;
                        
                        await signOut(auth);
                        
                        // After sign out, if they were NOT the admin, sign them in anonymously
                        // If they WERE the admin, onAuthStateChanged will re-sign them in with the token
                        if (!wasAdmin) {
                           await signInAnonymously(auth);
                        }
                        // onAuthStateChanged will handle UI updates
                    } catch (e) {
                        console.error("Sign out error:", e);
                    }
                });
            }
            
            // --- 4. Firestore: Load Lab Members ---
            async function loadLabMembers() {
                if (!db) return;
                
                const membersRef = collection(db, membersCollectionPath);
                const q = query(membersRef);
                
                onSnapshot(q, (snapshot) => {
                    // Clear the single members list
                    if (membersList) membersList.innerHTML = '';
                    
                    let members = [];
                    snapshot.forEach(doc => {
                        members.push({ id: doc.id, ...doc.data() });
                    });

                    // Sort by start year (descending) to show newest first
                    // Provide default '0' for stubs that haven't been edited
                    members.sort((a, b) => {
                        const yearA = parseInt(a.startYear || '0', 10);
                        const yearB = parseInt(b.startYear || '0', 10);
                        return yearB - yearA;
                    });

                    if (members.length === 0 && membersList) {
                         membersList.innerHTML = '<p class="text-gray-500">No members listed.</p>';
                         return;
                    }

                    members.forEach(member => {
                        const memberEl = createMemberElement(member);
                        if (membersList) membersList.appendChild(memberEl);
                    });

                }, (error) => {
                    console.error("Error loading lab members:", error);
                    if (membersList) membersList.innerHTML = '<p class="text-red-500">Error loading members.</p>';
                });
            }

            // --- 5. Firestore: Create Member Element ---
            function createMemberElement(member) {
                const el = document.createElement('div');
                el.className = "p-4 border rounded-md shadow-sm mb-4 flex justify-between items-start";
                
                // --- Build Date String ---
                let dateString = '';
                if (member.startYear) {
                    const startMonth = member.startMonth || '';
                    const endMonth = member.endMonth || 'Now';
                    const endYear = member.endYear || '';
                    dateString = `<p class="text-sm font-medium text-gray-600">${startMonth} ${member.startYear} — ${endMonth} ${endYear}</p>`;
                } else {
                    dateString = `<p class="text-sm text-gray-500 italic">Profile not yet completed</p>`;
                }
                
                // --- Build Institution String ---
                let institutionString = '';
                if (member.currentInstitution) {
                    institutionString = `<p class="text-sm text-gray-600">At: ${member.currentInstitution}</p>`;
                }

                // --- Build Research String ---
                let researchString = '';
                if (member.researchTopic) {
                    researchString = `<p class="text-sm text-gray-600 mt-2"><strong>Topic:</strong> ${member.researchTopic}</p>`;
                }
                
                // --- Build Publications String ---
                let publicationsString = '';
                if (member.publications) {
                    const pubs = member.publications.split('\n')
                        .filter(p => p.trim() !== '')
                        .map(p => `<li>${p.startsWith('http') ? `<a href="${p}" target="_blank" class="bio-link">${p}</a>` : p}</li>`)
                        .join('');
                    if (pubs) {
                        publicationsString = `<div classsection="text-sm text-gray-600 mt-2">
                            <strong>Publications:</strong>
                            <ul class="list-disc list-inside ml-4">${pubs}</ul>
                        </div>`;
                    }
                }

                // --- Build Links String ---
                let links = [];
                if (member.homepage) {
                    links.push(`<a href="${member.homepage}" target="_blank" class="bio-link">Homepage</a>`);
                }
                if (member.cvUrl) {
                    links.push(`<a href="${member.cvUrl}" target="_blank" class="bio-link">CV</a>`);
                }
                const linksString = links.length > 0 ? `<div class="text-sm mt-2">${links.join(' | ')}</div>` : '';


                // Owner is if the member's email matches the logged-in user's email
                const isOwner = currentUserEmail && (member.email === currentUserEmail);

                el.innerHTML = `
                    <div class="flex-grow">
                        <h4 class="font-bold text-lg">${member.name}</h4>
                        <p class="text-sm text-gray-500 mb-1">${member.email}</p>
                        ${dateString}
                        ${institutionString}
                        ${researchString}
                        ${publicationsString}
                        ${linksString}
                    </div>
                    <div class="flex-shrink-0 space-x-2">
                        ${isOwner ? `
                            <button data-id="${member.id}" class="btn-edit">Edit</button>
                            <button data-id="${member.id}" class="btn-danger">Delete</button>
                        ` : ''}
                    </div>
                `;
                
                if (isOwner) {
                    el.querySelector('.btn-edit').addEventListener('click', () => handleEdit(member));
                    el.querySelector('.btn-danger').addEventListener('click', () => handleDelete(member.id));
                }
                
                return el;
            }

            // --- 6. Firestore: Add New Member (Stub Profile) ---
            if (addMemberForm) {
                addMemberForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    if (!currentUserEmail && !initialAuthToken) {
                        alert("You must be logged in to add a member.");
                        return;
                    }
                    
                    const form = e.target;
                    // Create a stub profile. All other fields are null/empty.
                    const newMember = {
                        name: form.name.value,
                        email: form.email.value,
                        startMonth: "",
                        startYear: "",
                        endMonth: "Now",
                        endYear: "Now",
                        currentInstitution: "",
                        researchTopic: "",
                        publications: "",
                        homepage: "",
                        cvUrl: ""
                    };
                    
                    try {
                        await addDoc(collection(db, membersCollectionPath), newMember);
                        form.reset();
                    } catch (error) {
                        console.error("Error adding document: ", error);
                    }
                });
            }
            
            // --- 7. Firestore: Edit/Delete Handlers ---
            function handleEdit(member) {
                currentEditingDocId = member.id;
                
                // Populate modal fields
                document.getElementById('edit-name').value = member.name || '';
                document.getElementById('edit-email').value = member.email || '';
                document.getElementById('edit-start-month').value = member.startMonth || '';
                document.getElementById('edit-start-year').value = member.startYear || '';
                document.getElementById('edit-end-month').value = member.endMonth || 'Now';
                document.getElementById('edit-end-year').value = member.endYear || 'Now';
                document.getElementById('edit-current-institution').value = member.currentInstitution || '';
                document.getElementById('edit-research-topic').value = member.researchTopic || '';
                document.getElementById('edit-publications').value = member.publications || '';
                document.getElementById('edit-homepage').value = member.homepage || '';
                document.getElementById('edit-cv-url').value = member.cvUrl || '';
                
                // Trigger validation logic
                toggleInstitutionField();
                
                if (editModal) editModal.classList.remove('hidden');
            }

            async function handleDelete(docId) {
                if (confirm("Are you sure you want to delete this entry?")) {
                    try {
                        await deleteDoc(doc(db, membersCollectionPath, docId));
                    } catch (error) {
                        console.error("Error deleting document: ", error);
                    }
                }
            }
            
            // --- 8. Modal Form Handlers ---
            if (editMemberForm) {
                editMemberForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    if (!currentEditingDocId) return;
                    
                    const form = e.target;
                    
                    // Validate institution
                    const isNotNow = form.endMonth.value !== 'Now' && form.endYear.value !== 'Now';
                    const institution = form.currentInstitution.value.trim();
                    if (isNotNow && institution === '') {
                        alert("Please fill in 'Current Institution' as the end date is not 'Now'.");
                        return;
                    }

                    // Collect all new fields
                    const updatedMember = {
                        name: form.name.value,
                        email: form.email.value, // Key
                        startMonth: form.startMonth.value,
                        startYear: form.startYear.value,
                        endMonth: form.endMonth.value,
                        endYear: form.endYear.value,
                        currentInstitution: institution,
                        researchTopic: form.researchTopic.value,
                        publications: form.publications.value,
                        homepage: form.homepage.value,
                        cvUrl: form.cvUrl.value
                    };
                    
                    try {
                        const docRef = doc(db, membersCollectionPath, currentEditingDocId);
                        await setDoc(docRef, updatedMember); // setDoc overwrites
                        closeModal();
                    } catch (error) {
                        console.error("Error updating document: ", error);
                    }
                });
            }
            
            if (cancelEditButton) {
                cancelEditButton.addEventListener('click', closeModal);
            }
            
            function closeModal() {
                currentEditingDocId = null;
                if (editModal) editModal.classList.add('hidden');
                if (editMemberForm) editMemberForm.reset();
            }

            // --- 9. Tabbed Page & Basic UI Logic (Moved here) ---
            document.getElementById('year').textContent = new Date().getFullYear();
            
            // --- Helper: Populate Month/Year Selects ---
            const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            const startMonthSelect = document.getElementById('edit-start-month');
            const endMonthSelect = document.getElementById('edit-end-month');
            
            // Clear existing options (except "Now" for endMonth)
            if (startMonthSelect) startMonthSelect.innerHTML = '<option value="">Select...</option>';
            if (endMonthSelect) endMonthSelect.innerHTML = '<option value="Now">Now</option>';
            
            months.forEach(month => {
                const option = `<option value="${month}">${month}</option>`;
                if (startMonthSelect) startMonthSelect.innerHTML += option;
                if (endMonthSelect) endMonthSelect.innerHTML += option;
            });

            // --- Helper: Form Validation Logic ---
            const endMonth = document.getElementById('edit-end-month');
            const endYear = document.getElementById('edit-end-year');
            const institutionContainer = document.getElementById('institution-field-container');
            const institutionRequiredStar = document.getElementById('institution-required-star');
            const institutionInput = document.getElementById('edit-current-institution');

            function toggleInstitutionField() {
                const isNow = endMonth.value === 'Now' || endYear.value.toLowerCase() === 'now';
                
                if (isNow) {
                    if (institutionRequiredStar) institutionRequiredStar.classList.add('hidden');
                    if (institutionInput) institutionInput.required = false;
                    // Optional: clear and disable it
                    // if (institutionInput) institutionInput.value = '';
                    // if (institutionContainer) institutionContainer.classList.add('opacity-50');
                } else {
                    if (institutionRequiredStar) institutionRequiredStar.classList.remove('hidden');
                    if (institutionInput) institutionInput.required = true;
                    // if (institutionContainer) institutionContainer.classList.remove('opacity-50');
                }
            }
            
            if (endMonth) endMonth.addEventListener('change', toggleInstitutionField);
            if (endYear) endYear.addEventListener('input', toggleInstitutionField);


            const links = document.querySelectorAll('.sidebar-link');
            const mainContent = document.querySelector('main');
            
            links.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href').substring(1);

                    mainContent.querySelectorAll('section').forEach(section => {
                        section.classList.add('hidden');
                    });

                    if (targetId === 'home') {
                        document.getElementById('home').classList.remove('hidden');
                        document.getElementById('employment').classList.remove('hidden');
                        document.getElementById('education').classList.remove('hidden');
                    } else {
                        const targetSection = document.getElementById(targetId);
                        if (targetSection) {
                            targetSection.classList.remove('hidden');
                        }
                    }
                    
                    window.scrollTo(0, 0);
                });
            });
            
            // Initial Load
            document.getElementById('home').classList.remove('hidden');
            document.getElementById('employment').classList.remove('hidden');
            document.getElementById('education').classList.remove('hidden');
        }
        
        // Run the main app logic after the page is loaded
        document.addEventListener('DOMContentLoaded', main);

    </script>
    
    <!-- Removed the old, non-module script tag -->
    
</body>
</html>
